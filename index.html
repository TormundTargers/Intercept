<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Intercept</title>
    <script src="assets/phaser.min.js"></script>
</head>
<body>
<script>
// Global variables
var inputDirection = null;              // Stores the direction the actor is to move next
var speed = 3;                          // This is the number of pixels the actor will move each frame
var start = false;                      // If the game has started or not
var tileSize = 12;
var canvasWidth = tileSize * 80;
var canvasHeight = tileSize * 50;
var trails = [];
// Initialise trails array with false
for(var i=0;i<canvasWidth;i++) {
    trails[i] = [];
    for(var j=0;j<canvasHeight;j++) {
        trails[i][j] = false;
    }
}

// Canvas size is a multiple of 32. 32x32 is the size of each grid.
var game = new Phaser.Game(canvasWidth, canvasHeight, Phaser.CANVAS, 'intercept-canvas', { preload: preload, create: create,
    update: update, render: render });
// Player
var actor;
// Graphics Module
var graphics;

function preload() {
	// Assets that will be preloaded will go here.
    game.load.image('actor', 'assets/img/blueBike1.png');
    game.load.image('background', 'assets/img/backgroundTile12.png');

}

function create() {

    // This loads and tiles the background image
    game.add.tileSprite(0,0,canvasWidth,canvasHeight,'background');
    // Sets up the trail.
    graphics = game.add.graphics(0,0);
    graphics.lineStyle(3,0x3498DB,1);
    //  This creates a simple sprite that is using our loaded image and
    //  displays it on-screen
    actor = game.add.sprite(canvasWidth/2, canvasHeight/2, 'actor');
    actor.anchor.x = 0.5;
    actor.anchor.y = 0.5;
    actor.scale.x = 0.3;
    actor.scale.y = 0.3;
}

function update() {
	// Updated every frame
	if (start) {
        getInputDirection(function(){});
		// Main game code
        if(actor.x % tileSize == 0 && actor.y % tileSize == 0) {
            if (inputDirection != null) {
                actor.angle = inputDirection;
                inputDirection = null;
            }
        }
		switch (actor.angle) {
			case 0:
                    if(trails[actor.y - 1]) {
                        start = false
                    }
                    else {
                        actor.y -= speed;
                    }
				break;
			case 90:
                    if(trails[actor.x + 1]) {
                        start = false
                    }
                    else {
                        actor.x += speed;
                    }
				break;
			case -90:
                    if(trails[actor.x - 1]) {
                        start = false
                    }
                    else {
                        actor.x -= speed;
                    }
				break;
			case -180:
                    if(trails[actor.y + 1]) {
                        start = false;
                    }
                    else {
                        actor.y += speed;
                    }
				break;
		}
        graphics.lineTo(actor.x,actor.y);
        trails[actor.x][actor.y] = true;
	} else {
		getInputDirection(function() {
            start = true;
            graphics.moveTo(actor.x, actor.y);
            trails[actor.x][actor.y] = true;
        });
	}
}
    function getInputDirection(callback) {
        if (game.input.keyboard.isDown(Phaser.Keyboard.UP) && actor.angle != -180) {
            // Start game if enter pressed.
            callback();
            inputDirection = 0;
        }
        else if (game.input.keyboard.isDown(Phaser.Keyboard.DOWN) && actor.angle != 0) {
            // Start game if enter pressed.
            callback();
            inputDirection = -180;
        }
        else if (game.input.keyboard.isDown(Phaser.Keyboard.LEFT) && actor.angle != 90) {
            // Start game if enter pressed.
            callback();
            inputDirection = -90;
        }
        else if (game.input.keyboard.isDown(Phaser.Keyboard.RIGHT) && actor.angle != -90) {
            // Start game if enter pressed.
            callback();
            inputDirection = 90;
        }
    }

    function render() {
        game.debug.spriteInfo(actor, 20, 32);
    }

</script>
</body>
</html>
